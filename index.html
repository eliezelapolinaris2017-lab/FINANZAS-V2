<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nexus Finance</title>
  <link rel="icon" type="image/png" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=18"/>
  <style>
    :root{ --primary:#0B0D10; --accent:#C7A24B; --text:#F2F3F5; }
    *{box-sizing:border-box}
    body{margin:0;background:#111;color:var(--text);font:14px/1.3 system-ui,Segoe UI,Roboto,Arial}
    .sidebar{position:fixed;left:0;top:0;bottom:0;width:240px;background:#16181c;padding:10px;overflow:auto}
    .brand{display:flex;gap:10px;align-items:center;padding:8px 6px}
    .brand img{width:34px;height:34px;border-radius:6px}
    .menu{display:flex;flex-direction:column;gap:6px;margin-top:8px}
    .nav-btn{all:unset;background:#20242a;border:1px solid #2a2f36;padding:8px 10px;border-radius:10px;cursor:pointer}
    .nav-btn.active{border-color:var(--accent)}
    .btn,.btn-outline{all:unset;display:inline-block;padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn{background:var(--accent);color:#000;font-weight:700}
    .btn-outline{background:#1e2228;border:1px solid #30343b}
    .main{margin-left:240px;min-height:100vh}
    .topbar{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid #2a2f36;background:#14171b;position:sticky;top:0}
    .grow{flex:1}
    .view{display:none;padding:16px}
    .view.visible{display:block}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .card{background:#121417;border:1px solid #272b31;border-radius:14px;padding:12px}
    .card-title{font-weight:700;margin-bottom:8px}
    .kpi{font-size:24px;font-weight:800}
    .pills{display:flex;flex-wrap:wrap;gap:8px}
    .pills span,.pill{border:1px solid #2f343b;border-radius:999px;padding:4px 10px}
    table.data{width:100%;border-collapse:collapse}
    table.data th,table.data td{border-top:1px solid #2a2f36;padding:8px;text-align:left}
    table.data thead th{border-top:none;color:#b8bdc6}
    .row{display:flex;gap:8px;align-items:center}
    .row.between{justify-content:space-between}
    .right{text-align:right}
    .header-inline{display:flex;justify-content:space-between;align-items:center}
    .stats-wrap{display:flex;gap:8px}
    .stat-card{background:#0f1114;border:1px solid #262a30;border-radius:10px;padding:8px 10px}
    .num{font-variant-numeric:tabular-nums}
    .toasts{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:1000}
    .toast{background:#22262c;border:1px solid #30353d;border-radius:10px;padding:8px 12px;transition:opacity .3s}
    /* Login */
    .fullscreen-login{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:999}
    .fullscreen-login.visible{display:flex}
    .login-card{max-width:360px;margin:auto}
    .logo-preview{width:84px;height:84px;border-radius:12px;border:1px solid #333;object-fit:contain}
    .budget-bars .bar{height:10px;background:#222;border-radius:8px;overflow:hidden}
    .budget-bars .bar>span{display:block;height:10px;background:var(--accent)}
    .match-summary,.payroll-summary{display:flex;gap:8px}
    .match-card,.payroll-card{background:#101217;border:1px solid #2a2f36;border-radius:12px;padding:8px 10px}
    @media (max-width:980px){.main{margin-left:0} .sidebar{position:static;width:auto}}
  </style>
</head>
<body>

  <!-- ============== LOGIN ============== -->
  <div id="login" class="fullscreen-login view visible" aria-hidden="false">
    <div class="card login-card">
      <div class="row" style="gap:12px;align-items:center;margin-bottom:10px">
        <img src="assets/logo.png" alt="Logo" class="hero-logo" style="width:44px;height:44px;border-radius:10px"/>
        <div>
          <h1 style="margin:0">Nexus Finance</h1>
          <small>Gestión financiera</small>
        </div>
      </div>
      <h2 id="loginTitle">Ingresar PIN</h2>
      <p id="loginHint">Introduce tu PIN para continuar</p>
      <form id="loginForm" class="grid2">
        <label class="full">PIN
          <input id="loginPIN" type="password" inputmode="numeric" maxlength="8" placeholder="PIN" />
        </label>
        <div id="loginPIN2Wrap" class="full" style="display:none">
          <label>Repetir PIN
            <input id="loginPIN2" type="password" inputmode="numeric" maxlength="8" placeholder="Repetir PIN"/>
          </label>
        </div>
        <div class="full row center g">
          <button id="loginBtn" type="submit" class="btn">Entrar</button>
        </div>
      </form>
      <p id="loginAttempts" class="muted"></p>
    </div>
  </div>

  <!-- ============== SIDEBAR ============== -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <img id="brandLogo" src="assets/logo.png" alt="Logo"/>
      <div class="brand-info">
        <strong id="brandName">Mi Negocio</strong><br/>
        <small>Sistema financiero</small>
      </div>
    </div>

    <nav class="menu">
      <button class="nav-btn active" data-target="home">🏠 Inicio</button>
      <button class="nav-btn" data-target="expenses">💸 Gastos Diarios</button>
      <button class="nav-btn" data-target="incomes">💰 Entrada de Dinero</button>
      <button class="nav-btn" data-target="payments">🧾 Pago de Nómina</button>
      <button class="nav-btn" data-target="withholdings">🏛️ Retenciones (408/SS)</button>
      <button class="nav-btn" data-target="reports">📊 Reportes</button>
      <button class="nav-btn" data-target="exports">📤 Exportar PDF</button>
      <button class="nav-btn" data-target="ordinary">📅 Gastos Ordinarios</button>
      <button class="nav-btn" data-target="personal">🧍 Gastos Personales</button>
      <button class="nav-btn" data-target="budgets">📈 Control de Gastos</button>
      <button class="nav-btn" data-target="invoices">🧾 Crear Factura</button>
      <button class="nav-btn" data-target="quotes">📋 Crear Cotización</button>
      <button class="nav-btn" data-target="invoiceHistory">📜 Historial de Facturación</button>
      <button class="nav-btn" data-target="quoteHistory">📜 Historial de Cotizaciones</button>
      <button class="nav-btn" data-target="reconciliations">🏦 Conciliación Bancaria</button>
      <button class="nav-btn" data-target="settings">⚙️ Configuración</button>
      <button id="logoutBtn" class="nav-btn btn-outline">🚪 Salir</button>
    </nav>
  </aside>

  <!-- ============== MAIN ============== -->
  <main class="main">
    <div class="topbar">
      <button id="menuToggle" class="btn-outline">☰</button>
      <div class="grow"></div>
      <button id="printBtn" class="btn-outline">🖨️ Exportar PDF</button>
    </div>

    <!-- ===== INICIO ===== -->
    <section id="home" class="view visible" data-title="Inicio">
      <div class="grid">
        <div class="card">
          <div class="card-title">Ingresos (Mes)</div>
          <div class="kpi" id="kpiIncomesMonth">—</div>
          <small class="muted">= Salón ingreso (45%) + Ret. 408 pendiente (+ SS pendiente) + Entradas manuales</small>
        </div>
        <div class="card">
          <div class="card-title">Gastos (Mes)</div>
          <div class="kpi" id="kpiExpensesMonth">—</div>
          <small class="muted">= Gastos + Personales + Neto nómina pagado + 408/SS pagadas</small>
        </div>
        <div class="card">
          <div class="card-title">Balance (Mes)</div>
          <div class="kpi" id="kpiBalanceMonth">—</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Ingresos vs Gastos — Últimos 12 meses</div>
        <canvas id="chart12" height="180"></canvas>
      </div>
    </section>

    <!-- ===== GASTOS DIARIOS ===== -->
    <section id="expenses" class="view" data-title="Gastos Diarios">
      <div class="card">
        <div class="card-title">Nuevo gasto</div>
        <form id="expenseForm" class="grid3">
          <label>Fecha <input type="date" id="expDate"/></label>
          <label>Categoría
            <select id="expCategory">
              <option>Gasolina</option><option>Comida</option><option>Transporte</option>
              <option>Mantenimiento</option><option>Renta/Alquiler</option>
              <option>Servicios (Luz/Agua/Internet)</option><option>Insumos</option>
              <option>Nómina</option><option>Impuestos</option><option>Herramientas</option>
              <option>Publicidad/Marketing</option><option>Viajes</option><option>Papelería</option>
              <option>Licencias y Software</option><option>Seguros</option>
              <option>Equipos</option><option>Materiales</option><option>Otros</option>
            </select>
          </label>
          <label>Método
            <select id="expMethod">
              <option>Efectivo</option><option>Tarjeta</option><option>Cheque</option>
              <option>ATH Móvil</option><option>Transferencia</option>
            </select>
          </label>
          <label>Referencia <input type="text" id="expRef" placeholder="Ej. #cheque / #ATH / #tarjeta"/></label>
          <label class="full">Descripción <input type="text" id="expDesc" placeholder="Descripción"/></label>
          <label>Monto <input type="number" step="0.01" id="expAmount"/></label>
          <label>Nota <input type="text" id="expNote" placeholder="Nota"/></label>
          <div class="full row g">
            <button type="button" id="addExpense" class="btn-outline">Hoy</button>
            <button class="btn">Guardar Gasto</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="header-inline">
          <div class="card-title">Totales del período</div>
          <div class="stats-wrap">
            <div class="stat-card">
              <span class="label">Total general</span>
              <span class="value num" id="expSumTotal">—</span>
            </div>
          </div>
        </div>
        <div id="expSumPills" class="pills"></div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="card-title">Listado de gastos</div>
          <div class="row g">
            <label>Desde <input type="date" id="fExpFrom"/></label>
            <label>Hasta <input type="date" id="fExpTo"/></label>
            <button id="fExpApply" class="btn-outline">Filtrar</button>
          </div>
        </div>
        <table id="expensesTable" class="data">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Categoría</th>
              <th>Descripción</th>
              <th>Método</th>
              <th>Ref</th>
              <th>Monto</th>
              <th>Nota</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== ENTRADAS DE DINERO ===== -->
    <section id="incomes" class="view" data-title="Entradas de Dinero">
      <div class="card">
        <div class="card-title">Nuevo ingreso</div>
        <form id="incomeForm" class="grid3">
          <label>Fecha <input type="date" id="incDate"/></label>
          <label>Cliente/Origen <input type="text" id="incClient" placeholder="Cliente u origen"/></label>
          <label>Método
            <select id="incMethod">
              <option>Efectivo</option><option>Tarjeta</option><option>Cheque</option>
              <option>ATH Móvil</option><option>Transferencia</option>
            </select>
          </label>
          <label>Referencia <input type="text" id="incRef" placeholder="Ej. #cheque / #ATH / #tarjeta"/></label>
          <label>Monto <input type="number" step="0.01" id="incAmount"/></label>
          <div class="full row g">
            <button type="button" id="addIncome" class="btn-outline">Hoy</button>
            <button class="btn">Guardar Ingreso</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="header-inline">
          <div class="card-title">Totales por método</div>
          <div class="stats-wrap">
            <div class="stat-card">
              <span class="label">Total general</span>
              <span class="value num" id="incSumTotal">—</span>
            </div>
          </div>
        </div>
        <div id="incSumMethods" class="pills"></div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="card-title">Listado de ingresos</div>
          <div class="row g">
            <label>Desde <input type="date" id="fIncFrom"/></label>
            <label>Hasta <input type="date" id="fIncTo"/></label>
            <button id="fIncApply" class="btn-outline">Filtrar</button>
          </div>
        </div>
        <table id="incomesTable" class="data">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>Método</th>
              <th>Ref</th>
              <th>Monto</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== PAGO DE NÓMINA ===== -->
    <section id="payments" class="view" data-title="Pago de Nómina">
      <div class="card">
        <div class="card-title">Nuevo pago</div>
        <form id="paymentForm" class="grid3">
          <label>Fecha <input type="date" id="payDate"/></label>
          <label>Empleado/Beneficiario <input type="text" id="payTo" placeholder="Nombre"/></label>
          <label>Categoría <input type="text" id="payCategory" placeholder="Nómina / Servicio"/></label>

          <label>Monto Bruto <input type="number" step="0.01" id="payGross"/></label>
          <!-- Los siguientes son opcionales, quedan para compatibilidad -->
          <label>Seguro Social (fijo) <input type="number" step="0.01" id="payRetSS" value="0"/></label>
          <label>Otras Deducciones <input type="number" step="0.01" id="payRetOther" value="0"/></label>
          <label>Neto Calculado <input type="number" step="0.01" id="payAmount" readonly/></label>
          <label>Estado
            <select id="payStatus">
              <option>Pendiente</option>
              <option>Pagado</option>
            </select>
          </label>
          <div class="full row g">
            <button type="button" id="addPayment" class="btn-outline">Hoy</button>
            <button class="btn">Guardar Pago</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div id="payrollHeader">
          <div class="card-title">Resumen de Nómina</div>
          <div class="payroll-summary">
            <div class="payroll-card">
              <span>Total Nómina (Neto pagado)</span>
              <span class="value num" id="payrollTotal">—</span>
            </div>
            <div class="payroll-card">
              <span>Pagadas</span>
              <span class="value num" id="payrollPaid">—</span>
            </div>
            <div class="payroll-card">
              <span>Pendientes</span>
              <span class="value num" id="payrollPending">—</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Pagos</div>
        <table id="paymentsTable" class="data">
          <thead>
            <tr>
              <th>Fecha</th><th>Empleado/Benef.</th><th>Categoría</th>
              <th>Neto</th><th>Estado</th><th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== RETENCIONES (408/SS) ===== -->
    <section id="withholdings" class="view" data-title="Retenciones (408/SS)">
      <div class="card">
        <div class="card-title">Resumen de Retenciones</div>
        <div class="match-summary">
          <div class="match-card">408 Pendiente: <strong class="num" id="whSum408Pend">—</strong></div>
          <div class="match-card">408 Pagada: <strong class="num" id="whSum408Paid">—</strong></div>
          <div class="match-card">SS Pendiente: <strong class="num" id="whSumSSPend">—</strong></div>
          <div class="match-card">SS Pagada: <strong class="num" id="whSumSSPaid">—</strong></div>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="card-title">Historial por empleado</div>
          <div class="row g">
            <label>Desde <input type="date" id="whFrom"/></label>
            <label>Hasta <input type="date" id="whTo"/></label>
            <button id="whApply" class="btn-outline">Filtrar</button>
          </div>
        </div>
        <table id="withholdingsTable" class="data">
          <thead>
            <tr>
              <th>Fecha</th><th>Empleado</th><th>Bruto</th>
              <th>Salón 45%</th><th>Ret. 408</th><th>Estado 408</th>
              <th>SS</th><th>Estado SS</th><th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== REPORTES ===== -->
    <section id="reports" class="view" data-title="Reportes">
      <div class="grid">
        <div class="card"><div class="card-title">Hoy</div><div class="kpi" id="rToday">—</div><p class="muted">Ingresos / Gastos</p></div>
        <div class="card"><div class="card-title">Semana</div><div class="kpi" id="rWeek">—</div><p class="muted">Ingresos / Gastos</p></div>
        <div class="card"><div class="card-title">Mes</div><div class="kpi" id="rMonth">—</div><p class="muted">Ingresos / Gastos</p></div>
        <div class="card"><div class="card-title">Año</div><div class="kpi" id="rYear">—</div><p class="muted">Ingresos / Gastos</p></div>
      </div>
    </section>

    <!-- ===== EXPORTACIONES ===== -->
    <section id="exports" class="view" data-title="Exportaciones en PDF">
      <div class="card">
        <div class="card-title">Generar PDF</div>
        <div class="grid3">
          <button class="btn" data-print-view="expenses">Gastos Diarios</button>
          <button class="btn" data-print-view="incomes">Ingresos</button>
          <button class="btn" data-print-view="payments">Pago de Nómina</button>
          <button class="btn" data-print-view="personal">Gastos Personales</button>
          <button class="btn" data-print-view="invoices">Facturas (lista)</button>
          <button class="btn" data-print-view="quotes">Cotizaciones (lista)</button>
          <button class="btn" data-print-view="ordinary">Gastos Ordinarios</button>
          <button class="btn" data-print-view="reconciliations">Conciliación Bancaria</button>
        </div>
      </div>
    </section>

    <!-- ===== ORDINARIOS ===== -->
    <section id="ordinary" class="view" data-title="Gastos Ordinarios">
      <div class="card">
        <div class="card-title">Nuevo gasto recurrente</div>
        <form id="ordinaryForm" class="grid3">
          <label>Nombre <input type="text" id="ordName" placeholder="Luz / Internet / etc."/></label>
          <label>Monto <input type="number" step="0.01" id="ordAmount"/></label>
          <label>Frecuencia
            <select id="ordFreq">
              <option>Semanal</option><option>Mensual</option><option>Anual</option>
            </select>
          </label>
          <label>Próxima fecha <input type="date" id="ordNext"/></label>
          <div class="full row g">
            <button type="button" id="addOrd" class="btn-outline">Hoy</button>
            <button class="btn">Guardar</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="row between">
          <div class="card-title">Recurrentes</div>
          <div class="row g">
            <div><strong>Total:</strong> <span id="ordSumCount">0</span></div>
            <div><strong>Próximo:</strong> <span id="ordSumNext">—</span></div>
          </div>
        </div>
        <table id="ordinaryTable" class="data">
          <thead><tr><th>Nombre</th><th>Monto</th><th>Frecuencia</th><th>Próxima</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== PERSONALES ===== -->
    <section id="personal" class="view" data-title="Gastos Personales">
      <div class="card">
        <div class="card-title">Nuevo gasto personal</div>
        <form id="personalForm" class="grid3">
          <label>Fecha <input type="date" id="perDate"/></label>
          <label>Categoría <input type="text" id="perCategory" placeholder="Categoría"/></label>
          <label>Monto <input type="number" step="0.01" id="perAmount"/></label>
          <label class="full">Descripción <input type="text" id="perDesc" placeholder="Descripción"/></label>
          <div class="full row g">
            <button type="button" id="addPersonal" class="btn-outline">Hoy</button>
            <button class="btn">Guardar</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="header-inline">
          <div class="card-title">Total del período</div>
          <div class="stats-wrap">
            <div class="stat-card">
              <span class="label">Total personales</span>
              <span class="value num" id="perSumTotal">—</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Listado</div>
        <table id="personalTable" class="data">
          <thead><tr><th>Fecha</th><th>Categoría</th><th>Descripción</th><th>Monto</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ===== PRESUPUESTOS ===== -->
    <section id="budgets" class="view" data-title="Control de Gastos">
      <div class="card">
        <div class="card-title">Nuevo presupuesto por categoría</div>
        <form id="budgetForm" class="grid3">
          <label>Categoría <input type="text" id="budCategory" placeholder="Ej. Comida"/></label>
          <label>Límite <input type="number" step="0.01" id="budLimit"/></label>
          <div class="full row g">
            <button id="addBudget" class="btn">Guardar Presupuesto</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-title">Presupuestos y progreso</div>
        <div id="budgetBars" class="budget-bars"></div>
      </div>
    </section>

    <!-- ===== FACTURAS / COTIZACIONES / HISTORIALES / CONCILIACIÓN / CONFIG ===== -->
    <section id="invoices" class="view" data-title="Crear Factura"><div class="card"><div class="card-title">Factura</div><div>… (igual que tu versión, sin cambios funcionales) …</div></div></section>
    <section id="quotes" class="view" data-title="Crear Cotización"><div class="card"><div class="card-title">Cotización</div><div>…</div></div></section>
    <section id="invoiceHistory" class="view" data-title="Historial de Facturación"><div class="card"><div class="row between"><div class="card-title">Facturas</div><input id="invSearch" type="search" placeholder="Buscar # o cliente"/></div><table id="invoicesTable" class="data"><thead><tr><th>Fecha</th><th>#</th><th>Cliente</th><th>Total</th><th>Método</th><th></th></tr></thead><tbody></tbody></table></div></section>
    <section id="quoteHistory" class="view" data-title="Historial de Cotizaciones"><div class="card"><div class="row between"><div class="card-title">Cotizaciones</div><input id="quoSearch" type="search" placeholder="Buscar # o cliente"/></div><table id="quotesTable" class="data"><thead><tr><th>Fecha</th><th>#</th><th>Cliente</th><th>Total</th><th>Método</th><th></th></tr></thead><tbody></tbody></table></div></section>
    <section id="reconciliations" class="view" data-title="Conciliación Bancaria"><div class="card"><div class="card-title">Conciliaciones</div><div>…</div></div></section>

    <!-- TOASTS -->
    <div id="toastContainer" class="toasts"></div>
  </main>

  <!-- ============== SCRIPTS ============== -->
  <script type="module" src="app.js?v=18"></script>
</body>
</html>
